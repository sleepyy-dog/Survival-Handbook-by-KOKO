# Week2a

## 差值与数值积分

> #### **三种插值方法:**
>
> 插值问题的提法是：已知$n+1$个节点$(x_j, y_j)$（$j=0, 1, \dots, n$），其中$x_j$互不相同。不妨设$a=x_0<x_1<\dots<x_n=b$，求任一插值点$x^*$（$x^* \neq x_j$）处的插值$y^*$。节点$(x_j, y_j)$可以看成是由某个函数$y=g(x)$产生的，但$g(x)$的解析表达式可能十分复杂，或不存在解析形式，而仅由离散数据点给出。
>
> 求解的基本思路是构造一个相对简单的函数$y=f(x)$（称为插值函数），使其通过全部节点，即满足$f(x_j)=y_j$（$j=0, 1, \dots, n$），再用$f(x)$计算插值，即$y^*=f(x^*)$。

本节介绍三种基本的、常用的插值方法：**拉格朗日多项式插值**、**分段线性插值**和**三次样条插值**。

### 拉格朗日多项式插值法

从理论和计算角度看，多项式是最简单的函数。设插值函数是$n$次多项式，记作：
$$
L_n(x) = a_n x^n + a_{n-1}x^{n-1} + \dots + a_1x + a_0
$$
对于给定的$n+1$个节点$(x_j, y_j)$，插值多项式必须满足：
$$
L_n(x_j) = y_j, \quad j=0, 1, \dots, n
$$
为了确定插值多项式$L_n(x)$中的$n+1$个系数$a_n, a_{n-1}, \dots, a_0$，将上述条件代入多项式表达式，得到一个线性方程组：
$$
\begin{cases}
a_n x_0^n + a_{n-1}x_0^{n-1} + \dots + a_1x_0 + a_0 = y_0 \\
a_n x_1^n + a_{n-1}x_1^{n-1} + \dots + a_1x_1 + a_0 = y_1 \\
\vdots \\
a_n x_n^n + a_{n-1}x_n^{n-1} + \dots + a_1x_n + a_0 = y_n
\end{cases}
\label{eq:lagrange_system}
$$
该方程组\eqref{eq:lagrange_system}可简写为矩阵形式：
$$
\mathbf{Xa} = \mathbf{y}
$$
其中，
$$
\mathbf{X} = \begin{bmatrix} x_0^n & x_0^{n-1} & \cdots & x_0 & 1 \\ x_1^n & x_1^{n-1} & \cdots & x_1 & 1 \\ \vdots & \vdots & & \vdots & \vdots \\ x_n^n & x_n^{n-1} & \cdots & x_n & 1 \end{bmatrix}, \quad \mathbf{a} = \begin{pmatrix} a_n \\ a_{n-1} \\ \vdots \\ a_0 \end{pmatrix}, \quad \mathbf{y} = \begin{pmatrix} y_0 \\ y_1 \\ \vdots \\ y_n \end{pmatrix}
$$
系数矩阵$\mathbf{X}$的行列式$|\mathbf{X}|$是范德蒙德（Vandermonde）行列式：
$$
|\mathbf{X}| = \prod_{0 \le j < k \le n} (x_k - x_j)
$$
由于所有节点$x_j$互不相同，故$|\mathbf{X}| \neq 0$，这意味着线性方程组\eqref{eq:lagrange_system}的解$\mathbf{a}$存在且唯一。因此，通过$n+1$个不同节点的$n$次插值多项式是唯一确定的。

在实际计算中，直接求解该线性方程组来确定系数$\mathbf{a}$并不方便。一种更具构造性的方法是先构造一组基函数：
$$
l_i(x) = \prod_{\substack{j=0 \\ j \neq i}}^{n} \frac{x-x_j}{x_i-x_j} = \frac{(x-x_0)\dots(x-x_{i-1})(x-x_{i+1})\dots(x-x_n)}{(x_i-x_0)\dots(x_i-x_{i-1})(x_i-x_{i+1})\dots(x_i-x_n)}, \quad i=0, 1, \dots, n
$$
这组$n$次多项式基函数$l_i(x)$具有如下特性：
$$
l_i(x_j) = \delta_{ij} = \begin{cases} 1, & i=j \\ 0, & i \neq j \end{cases}, \quad i,j=0, 1, \dots, n
$$
于是，满足插值条件的$n$次拉格朗日插值多项式就可以直接构造出来：
$$
L_n(x) = \sum_{i=0}^n y_i l_i(x)
$$

#### 误差估计

对于任意的插值点$x \in [a,b]$，插值的误差定义为插值多项式$L_n(x)$与原函数$g(x)$之差，记作$R_n(x)$。如果$g(x)$具有$n+1$阶连续导数，则可以证明其误差为：
$$
R_n(x) = g(x) - L_n(x) = \frac{g^{(n+1)}(\xi)}{(n+1)!} \prod_{j=0}^{n} (x-x_j), \quad \xi \in (a,b) \label{eq:lagrange_error}
$$
若$g(x)$的$n+1$阶导数有界，即存在$M_{n+1}$使得：
$$
|g^{(n+1)}(x)| \le M_{n+1}, \quad \forall x \in [a,b]
$$
则误差$R_n(x)$的绝对值满足：
$$
|R_n(x)| \le \frac{M_{n+1}}{(n+1)!} \left| \prod_{j=0}^{n} (x-x_j) \right|
$$
实际上，由于$M_{n+1}$通常难以确定，所以公式\eqref{eq:lagrange_error}主要用于理论分析而非精确的误差计算。尽管如此，它仍然揭示了误差的一些性质：插值点$x$越接近节点$x_j$，误差$|R_n(x)|$越小；被插值函数$g(x)$越平缓（即高阶导数越小），误差$|R_n(x)|$也越小。而增加节点数$n$对误差的影响则较为复杂，并不总是能减小误差。

> #### **题目 (例1):**
>
> 用函数$y=g(x)=\sin(\frac{\pi x}{2})$在$[0,1]$区间上等距地产生$n+1$个节点，当$n=1, 2, \dots$时，考察拉格朗日插值多项式$L_n(x)$的误差。

**解：**

拉格朗日插值多项式的余项（误差）公式为：
$$
R_n(x) = \frac{g^{(n+1)}(\xi_x)}{(n+1)!} \prod_{j=0}^{n} (x-x_j), \quad \xi_x \in (0,1)
$$
对于给定的函数$g(x) = \sin(\frac{\pi x}{2})$，我们首先计算其高阶导数以确定误差上界$M_{n+1}$。
$$
g'(x) = \frac{\pi}{2}\cos\left(\frac{\pi x}{2}\right)
$$
$$
g''(x) = -\left(\frac{\pi}{2}\right)^2\sin\left(\frac{\pi x}{2}\right)
$$
$$
g'''(x) = -\left(\frac{\pi}{2}\right)^3\cos\left(\frac{\pi x}{2}\right)
$$
可以归纳出，其$n+1$阶导数的绝对值上界为：
$$
|g^{(n+1)}(x)| \le \left(\frac{\pi}{2}\right)^{n+1}
$$
因此，我们可以取误差界中的$M_{n+1}$为：
$$
M_{n+1} = \sup_{x \in [0,1]} |g^{(n+1)}(x)| = \left(\frac{\pi}{2}\right)^{n+1}
$$
由于$n+1$个节点在$[0,1]$区间上等距分布，节点间距为$h = \frac{1-0}{n} = \frac{1}{n}$，节点坐标为$x_j = jh$（其中$j=0, 1, \dots, n$）。

接下来，我们估计连乘项$\left| \prod_{j=0}^{n} (x-x_j) \right|$的上界。对于等距节点，有以下常用不等式：
$$
\left| \prod_{j=0}^{n} (x-x_j) \right| \le \frac{n!}{4} h^{n+1}
$$
综合以上结果，可得误差$|R_n(x)|$的上界估计：
$$
|R_n(x)| \le \frac{M_{n+1}}{(n+1)!} \max_{x \in [0,1]} \left| \prod_{j=0}^{n} (x-x_j) \right| \le \frac{(\pi/2)^{n+1}}{(n+1)!} \cdot \frac{n! h^{n+1}}{4}
$$
化简上式可得：
$$
|R_n(x)| \le \frac{1}{4(n+1)} \left(\frac{\pi h}{2}\right)^{n+1}
$$
最后，将$h=1/n$代入，得到最终的误差估计表达式：
$$
|R_n(x)| \le \frac{1}{4(n+1)} \left(\frac{\pi}{2n}\right)^{n+1}
$$

**证毕。**

> [!TIP]
>
> 并非所有情况下插值误差都会随节点数$n$的增大而减小，一个著名的反例是**龙格 (Runge) 现象**。当对以下函数在等距节点上进行高次多项式插值时，插值多项式会在区间两端出现剧烈振荡，导致误差很大。
> $$
> g(x) = \frac{1}{1+x^2}, \quad x \in [-5, 5]
> $$

### 分段线性插值

分段线性插值是将每两个相邻的节点用直线连接起来，如此形成的一条折线函数。该函数记作$I_n(x)$，它满足$I_n(x_j)=y_j$，且在每个小区间$[x_j, x_{j+1}]$上是线性函数（$j=0, 1, \dots, n-1$）。

$I_n(x)$可以表示为一组基函数的线性组合：
$$
I_n(x) = \sum_{j=0}^{n} y_j l_j(x)
$$
其中基函数$l_j(x)$是“帽函数”（hat function），其图像形似一个帐篷，在$x_j$处取值为1，在其他所有节点$x_k (k \neq j)$处取值为0。其定义为：
$$
l_j(x) = \begin{cases} \frac{x-x_{j-1}}{x_j-x_{j-1}}, & x \in [x_{j-1}, x_j] \\ \frac{x_{j+1}-x}{x_{j+1}-x_j}, & x \in [x_j, x_{j+1}] \\ 0, & \text{其他} \end{cases}
$$
对于端点$j=0$和$j=n$，上述定义中不存在的区间上的部分值为零。

$I_n(x)$有良好的收敛性，即对于$x \in [a,b]$，当节点间距趋于零时，有$\lim_{n \to \infty} I_n(x) = g(x)$。用$I_n(x)$计算$x$点的插值时，只用到$x$左右的两个节点，计算量与节点总数$n$无关。但是$n$越大，分段越多，插值误差通常越小。实际上，在许多查表计算的应用中（如数学物理中的特殊函数表、数理统计中的概率分布表等），分段线性插值已经足够精确。

### 三次样条函数

三次样条函数记作$S(x)$（$x \in [a, b]$），它需要满足以下条件：

1.  在每个子区间$[x_{i-1}, x_i]$（$i=1, 2, \dots, n$）上，$S(x)$是次数不超过三次的多项式。
2.  $S(x)$在整个区间$[a, b]$上具有二阶连续导数，即$S(x) \in C^2[a, b]$。
3.  $S(x)$穿过所有给定的数据点，即$S(x_i)=y_i$（$i=0, 1, \dots, n$）。

根据条件(1)，我们可以将$S(x)$在每个子区间上的表达式记为：
$$
S(x) = S_i(x) = a_i x^3 + b_i x^2 + c_i x + d_i, \quad x \in [x_{i-1}, x_i], \quad i = 1, 2, \dots, n
$$
这里共有$n$个三次多项式，每个多项式有4个系数，所以总计有$4n$个待定系数。插值条件(3)给出了$n+1$个方程，而条件(2)的连续性要求在$n-1$个内部节点$x_i$处必须满足：
$$
\begin{cases} S_i(x_i) = S_{i+1}(x_i) \\ S'_i(x_i) = S'_{i+1}(x_i) \\ S''_i(x_i) = S''_{i+1}(x_i) \end{cases}, \quad i = 1, 2, \dots, n-1
$$
这些条件总共给出了$4n-2$个方程。为了确定全部$4n$个待定系数，还需要补充两个边界条件。在实际应用中，通常根据问题的性质选择以下三种边界条件之一：

*   **第一类边界条件 (Clamped Spline):** 给定两端点的一阶导数值$S'(x_0)$和$S'(x_n)$。
*   **第二类边界条件 (Natural Spline):** 给定两端点的二阶导数值$S''(x_0)$和$S''(x_n)$。最常用的是令它们为零，称为自然边界条件：
    $$
    S''(x_0) = S''(x_n) = 0
    $$
*   **第三类边界条件 (Periodic Spline):** 当被插值函数为周期函数时，要求样条函数在两端点的一阶和二阶导数值分别相等，即$S'(x_0)=S'(x_n)$和$S''(x_0)=S''(x_n)$。

可以证明，在给定上述任意一种边界条件后，所构成的$4n$元线性方程组均有唯一解，即三次样条函数$S(x)$被唯一确定。

与分段线性函数$I_n(x)$一样，三次样条函数$S(x)$也有良好的收敛性，即在相当一般的条件下，当节点间距趋于零时，$\lim_{n \to \infty} S(x) = g(x)$。

> [!NOTE]
>
> - **牛顿均差插值**: 其插值多项式与拉格朗日插值的结果完全一致，但其计算具有继承性，即增加新的插值点时，可以利用之前的计算结果，而无需从头计算。（不考）
> - **埃尔米特 (Hermite) 插值**: 在给定的节点处，不仅要求函数值相等，还要求导数值也相等，是一种更高阶的插值方法。

> ## 小结：
>
> 多项式逼近发现龙格现象，决定改用线性来保证收敛性，再高次一点即为三次样条插值。

